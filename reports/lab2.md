# ch4 实验实现总结
1：sys_get_time 和 sys_task_info 一样，先把用户传入的指针用slice 转为 u8可变数组，长度为 sizeof 对结构体的返回值。然后在内核中定义同样的数据结构，设置好值之后，按照 u8 的大小挨个复制进去。

2：map实现中，先考虑地址对齐和 len 的按页大小对齐以及 port 的属性是否合法，之后考虑是否存在已经被映射的页，最后调用memset的insert_framed_area插入即可。

3：munmap 实现中，先考虑地址对齐和 len 的按页大小对齐，之后考虑是否存在没有被映射的页，最后找到TCB中属于该范围的area并调用area的unmap函数，他会自动解除页表映射同时会删除虚拟地址和物理帧的映射。

注意点：pagetable中的find_pte函数返回值不是none，也不能说该virtaddr就已经分配了物理页，他的返回值pagetableEntry值有可能是全0，做个valid验证即可。

# 问答题

## 1、SV39 分页模式下的页表项

SV39分页模式下，物理地址56bit，虚拟地址39bit。但一个合理的虚拟地址高bit要和第38bit保持一致，避免地址滥用。

0-9 bit 位用于表示该页的一些属性。0-7 bit分别代表 V，R，W，X，U，G，A，D。8-9两个 bit 用于保留给 OS 使用。10-53用于表示物理页帧，最高10bit保留。

页表项仅当 V(Valid) 位为 1 时，页表项才是合法的；

R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；

U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；


A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；

D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。

